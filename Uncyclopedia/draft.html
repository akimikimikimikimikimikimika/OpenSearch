<!doctype html>
<html class="hide-bar" xmlns="http://www.w3.org/1999/xhtml" lang="ja-JP" xml:lang="ja-JP">
	<head>
		<meta charset="UTF-8" />
		<title>Uncyclopedia</title>

		<meta name="referrer" content="no-referrer" />
		<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no,viewport-fit=cover" />
		<meta name="format-detection" content="telephone=no" />

		<meta name="apple-mobile-web-app-title" content="Uncyclopedia" />
		<link rel="shortcut icon" href="../Resources/search.png" />

		<link rel="stylesheet" href="../Resources/main.css" />
		<link rel="stylesheet" href="../Resources/default.css" />

	</head>
	<body>
		<div id="header">
			<div>
				<form action="https://ja.uncyclopedia.info/index.php" method="GET">
					<input type="text" role="searchbox" placeholder="Uncyclopedia" name="search" autofocus="autofocus" />
				</form>
				<a style="--image:url(images/icon.svg);" id="icon" href="https://ja.uncyclopedia.info/wiki/Main_Page"></a>
			</div>
		</div>
		<noscript><div id="message"><div>Type keywords above and press return key</div></div></noscript>
		<script>
			(()=>{

				/* dom function abbreviation */
				let qs=(q,t=document.body)=>t.querySelector(q),
				ce=(html)=>{
					let d=document.createElement("div");
					d.innerHTML=html;
					let e=d.firstChild;
					d.removeChild(e);
					return e;
				};

				/* element */
				let q=qs("input[name=\"search\"]"),
				f=qs("form"), /* form */
				a=qs("a"); /* icon */

				/* icon works as a submit button */
				a.addEventListener("click",e=>{
					if (q.value!="") {f.submit();e.preventDefault();}
				});

				/* list constructor */
				let construct=(data)=>{
					let o={
						data:data,
						node:ce(`<div class="list" />`),
						current:0,
					};
					let p=new Proxy(o,{
						set:(t,p,n)=>{
							if (p=="current") {
								o.current=n;
								didStateChange();
								data.forEach((d,m)=>d.node.classList.toggle("selected",n==m));
							}
						}
					});
					data.forEach((d,n)=>{
						let cell=ce(`<div><div>${d.name}</div></div>`);
						if (n==0) cell.classList.toggle("selected");
						cell.style.setProperty("--char",d.char?`"${d.char}"`:'" "');
						cell.style.setProperty("--image",d.image?`url(${d.image})`:"");
						cell.addEventListener("click",()=>{p.current=n;q.focus();});
						d.node=cell;
						o.node.append(cell);
					});
					return p;
				};

				let url="https://www.bing.com/",local="mkt=ja-jp&setLang=ja-jp&cc=jp";

				let didStateChange=()=>{
					let d=search.data[search.current];
					a.href=d.link;
					a.style.setProperty("--image",d.image?`url(${d.image})`:"");
					a.textContent=d.char?d.char:"";
					f.action=d.action;
					f.onsubmit=d.submit?d.submit:null;
					q.name=d.query?d.query:"search";
					q.placeholder=d.placeholder?d.placeholder:d.name;
				};

				/* search data */
				let search=construct([
					...["ja.uncyclopedia.info","ansaikuropedia.org","ja.ansaikuropedia.org","ja.uncyclopedia.org","ja.uncyc.org","ja.uncyclomedia.org","アンサイクロペディア.com","ansaikuropedia.miraheze.org"].map(d=>{
						return {
							name:d,
							placeholder:"Uncyclopedia",
							image:"images/icon.svg",
							char:"",
							link:`https://${d}/wiki/メインページ`,
							action:`https://${d}/index.php`
						};
					}),
					{
						name:"Chakuwiki",
						image:"",
						char:"C",
						link:"https://wiki.chakuriki.net/",
						action:"https://wiki.chakuriki.net/index.php"
					},
					{
						name:"ピクシブ大百科",
						image:"",
						char:"P",
						link:"https://dic.pixiv.net",
						action:"https://dic.pixiv.net/search",
						query:"query"
					},
					{
						name:"ニコニコ大百科",
						image:"",
						char:"N",
						link:"https://dic.nicovideo.jp",
						action:"https://dic.nicovideo.jp",
						submit:e=>{
							if (q.value) location.href=`https://dic.nicovideo.jp/s/all/t/${encodeURIComponent(q.value)}/rev_created/desc/1-`;
							else q.value="https://dic.nicovideo.jp";
							e.preventDefault();
						}
					}
				]);
				document.body.append(search.node);

				didStateChange();
				window.addEventListener("load",()=>q.focus());

			})();
		</script>
	</body>
</html>