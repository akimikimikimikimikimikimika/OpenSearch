<!doctype html>
<html class="hide-bar" xmlns="http://www.w3.org/1999/xhtml" lang="ja-JP" xml:lang="ja-JP">
	<head>
		<meta charset="UTF-8" />
		<meta name="referrer" content="never" />
		<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no,viewport-fit=cover" />
		<meta name="format-detection" content="telephone=no,email=no,address=no" />
		<meta name="application-name" content="Search" />
		<meta name="apple-mobile-web-app-title" content="Search" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<title>Search</title>
		<link rel="stylesheet" href="../Resources/main.css" />
		<link rel="stylesheet" href="../Resources/default.css" />
		<script></script>
	</head>
	<body>
		<div id="header">
			<div>
				<form action="https://encrypted.google.com/search" method="GET">
					<input type="text" role="searchbox" placeholder="Package index" name="q" autofocus="autofocus" />
				</form>
				<a style="--image:url(../Google/images/google.svg);" id="icon" href="https://encrypted.google.com/webhp"></a>
				<!--
					<div id="bottomBar">
						<div class="selected">Item 1</div>
						<div>Item 2</div>
						<div>Item 3</div>
						<div>Item 4</div>
						<div>Item 5</div>
						<div>Item 6</div>
						<div>Item 7</div>
						<div>Item 8</div>
						<div>Item 9</div>
						<div>Item 10</div>
					</div>
				-->
			</div>
		</div>
		<!--
			<div id="list">
				<div style="--char:'';--image:url(../Bing/Bing.svg);"><div>Item 1</div></div>
				<div class="selected" style="--char:'G';"><div>Item 2</div></div>
				<div><div>Item 3</div></div>
				<div><div>Item 4</div></div>
				<div><div>Item 5</div></div>
				<div><div>Item 6</div></div>
				<div><div>Item 7</div></div>
				<div><div>Item 8</div></div>
				<div><div>Item 9</div></div>
				<div><div>Item 10</div></div>
			</div>
		-->
		<noscript><div id="message"><div>Type keywords above and press return key</div></div></noscript>
		<script>
			(()=>{

				/* dom function abbreviation */
				let qs=(q,t=document.body)=>t.querySelector(q),
				ce=(html)=>{
					let d=document.createElement("div");
					d.innerHTML=html;
					let e=d.firstChild;
					d.removeChild(e);
					return e;
				};

				/* element */
				let q=qs('[name="q"]'),
				f=qs("form"), /* form */
				a=qs("a"), /* icon */
				tbm=qs('input[name="tbm"]'),
				btnI=ce(`<input type="hidden" name="btnI" value="" />`);

				/* icon works as a submit button */
				a.addEventListener("click",e=>{
					if (q.value!="") {f.submit();e.preventDefault();}
				});

				/* list constructor */
				let construct=(data)=>{
					let o={
						data:data,
						node:ce(`<div class="list" />`),
						current:0,
					};
					let p=new Proxy(o,{
						set:(t,p,n)=>{
							if (p=="current") {
								o.current=n;
								didStateChange();
								data.forEach((d,m)=>d.node.classList.toggle("selected",n==m));
							}
						}
					});
					data.forEach((d,n)=>{
						let cell=ce(`<div><div>${d.name}</div></div>`);
						if (n==0) cell.classList.toggle("selected");
						cell.style.setProperty("--char",d.char?`"${d.char}"`:'" "');
						cell.style.setProperty("--image",d.image?`url(${d.image})`:"");
						cell.addEventListener("click",()=>{p.current=n;q.focus();});
						d.node=cell;
						o.node.append(cell);
					});
					return p;
				};

				/* toggle a certain parameter */
				let tp=(p,b)=>{
					if (p.parentNode&&(!b)) params.search.removeChild(p);
					if ((!p.parentNode)&&b) params.search.appendChild(p);
					return p;
				};

				/* called when the state changed */
				let didStateChange=()=>{
					let sd=search.data[search.current];
					let dd=domains.data[domains.current];
					if ((sd.param===params.search)&&(dd.tld=="cn")) {domains.current=0;return;}
					if ((sd.param===params.search)&&domains.data[cn].node.parentNode) domains.node.removeChild(domains.data[cn].node);
					if ((sd.param!==params.search)&&(!domains.data[cn].node.parentNode)) domains.node.insertBefore(domains.data[cn].node,domains.node.childNodes[cn]);
					a.href=sd.link.replace("{com}",dd.tld);
					a.style.setProperty("--image",sd.image?`url(${sd.image})`:"");
					f.action=sd.action.replace("{com}",dd.tld);
					tp(tbm,sd.tbm!=undefined).value=sd.tbm;
					tp(btnI,sd.btnI);
					f.onsubmit=sd.submit??null;
					f.replaceChild(sd.param,qs("#params"));
					q.name=sd.query??"q";
					q.placeholder=sd.fullName??"Google";
				};

				/* parameter lists */
				let params={
					search:qs("#params"),
					maps:ce(`<span id="params"><input type="hidden" name="hl" value="ja" /></span>`),
					translate:ce(`<span id="params"><input type="hidden" name="hl" value="ja" /><input type="hidden" name="sl" value="auto" /><input type="hidden" name="tl" value="ja" /></span>`)
				};

				/* event handler (submit) for translate */
				let tr=(()=>{
					let f=e=>{
						location.href=url("translate","")+"#view=home&op=translate&hl=ja&sl=auto&tl=ja&text="+encodeURIComponent(q.value);
						e.preventDefault();
					};
					return e=>f(e);
				})();

				/* search data */
				let url=(sd,pt,keep)=>`https://${sd}.google.${keep?"com":"{com}"}/${pt}`,param="?ie=utf-8&oe=utf-8&hl=ja&gl=ja";
				let search=construct([
					{
						name:"Web",
						image:"google",
						link:url("www","webhp")+param,
						action:url("www","search"),
						tbm:"",
						param:params.search
					},
					{
						name:"I'm feeling lucky",
						image:"google",
						fullName:"I'm feeling lucky",
						link:url("www","webhp")+param,
						action:url("www","search"),
						tbm:"",
						btnI:true,
						param:params.search
					},
					{
						name:"Maps",
						image:"googlemaps",
						fullName:"Google Maps",
						link:url("www","maps")+param,
						action:url("www","maps"),
						tbm:"",
						param:params.maps
					},
					{
						name:"Translate",
						image:"googletranslate",
						fullName:"translate it into Japanese",
						link:url("translate","")+"?hl=ja#view=home&op=translate&sl=auto&tl=ja&text=",
						action:url("translate",""),
						tbm:"",
						query:"text",
						param:params.translate,
						submit:tr
					},
					{
						name:"Images",
						image:"google",
						fullName:"Google Images",
						link:url("images","")+param,
						action:url("www","search"),
						tbm:"isch",
						param:params.search
					},
					{
						name:"Videos",
						image:"google",
						fullName:"Google Videos",
						link:url("www","videohp")+param,
						action:url("www","search"),
						tbm:"vid",
						param:params.search
					},
					{
						name:"News",
						image:"googlenews",
						fullName:"Google News",
						link:url("news","topstories",true)+"?hl=ja&gl=JP&ceid=JP:ja",
						action:url("www","search"),
						tbm:"nws",
						param:params.search
					},
					{
						name:"Books",
						image:"google",
						fullName:"Google Books",
						link:url("books","")+param,
						action:url("www","search"),
						tbm:"bks",
						param:params.search
					},
					{
						name:"Shopping",
						image:"google",
						fullName:"Google Shopping",
						link:url("www","shopping")+param,
						action:url("www","search"),
						tbm:"shop",
						param:params.search
					},
					{
						name:"Finance",
						image:"google",
						fullName:"Google Finance",
						link:url("www","finance")+param,
						action:url("www","search"),
						tbm:"fin",
						param:params.search
					}
				].map(d=>{
					d.char="";
					d.image=`../Google/images/${d.image}.svg`;
					return d;
				}));
				document.body.append(search.node);

				/* domain data */
				let domains=construct("com,cat,ad,ae,com.af,com.ag,com.ai,al,am,co.ao,com.ar,as,at,com.au,az,ba,com.bd,be,bf,bg,com.bh,bi,bj,com.bn,com.bo,com.br,bs,bt,co.bw,by,com.bz,ca,cd,cf,cg,ch,ci,co.ck,cl,cm,cn,com.co,co.cr,com.cu,cv,com.cy,cz,de,dj,dk,dm,com.do,dz,com.ec,ee,com.eg,es,com.et,fi,com.fj,fm,fr,ga,ge,gg,com.gh,com.gi,gl,gm,gr,com.gt,gy,com.hk,hn,hr,ht,hu,co.id,ie,co.il,im,co.in,iq,is,it,je,com.jm,jo,co.jp,co.ke,kg,com.kh,ki,co.kr,com.kw,kz,la,com.lb,li,lk,co.ls,lt,lu,lv,com.ly,co.ma,md,me,mg,mk,ml,com.mm,mn,ms,com.mt,mu,mv,mw,com.mx,com.my,co.mz,com.na,ne,com.ng,com.ni,nl,no,com.np,nr,nu,co.nz,com.om,com.pa,com.pe,com.pg,com.ph,com.pk,pl,pn,com.pr,ps,pt,com.py,com.qa,ro,ru,rw,com.sa,com.sb,sc,se,com.sg,sh,si,sk,com.sl,sm,sn,so,sr,st,com.sv,td,tg,co.th,com.tj,tl,tm,tn,to,com.tr,tt,com.tw,co.tz,com.ua,co.ug,co.uk,com.uy,co.uz,com.vc,co.ve,vg,co.vi,com.vn,vu,ws,co.za,co.zm,co.zw".split(",").map(tld=>{
					var c="";
					switch (tld) {
						case "com": c="🌎"; break;
						case "cat": c="🐈"; break;
						case "co.uk": c="";
						default:
							let cc=tld.match(/[a-z]{2}$/)[0];
							c=String.fromCodePoint(...Array.from(cc=="uk"?"gb":cc).map(v=>parseInt(v,36)-10+0x1F1E6));
					}
					return {
						name:"Google."+tld,
						char:c,
						tld:tld
					};
				}));
				domains.node.classList.toggle("hidden",true);
				document.body.append(domains.node);
				let cn=domains.data.findIndex(d=>d.tld=="cn");

				document.documentElement.classList.toggle("hide-bar",false);
				let bb=qs("#header>div").appendChild(ce(`<div id="bottomBar"><div class="selected">Search for</div><div>Domains</div></div>`));
				let setBB=n=>{
					bb.childNodes.forEach((b,m)=>b.classList.toggle("selected",n==m));
					[search,domains].forEach((o,m)=>o.node.classList.toggle("hidden",n!=m));
				};
				bb.childNodes.forEach((b,n)=>b.addEventListener("click",e=>{setBB(n);e.preventDefault();}));

				didStateChange();

			})();
		</script>
	</body>
</html>