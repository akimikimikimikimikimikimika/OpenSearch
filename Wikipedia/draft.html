<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja-JP" xml:lang="ja-JP">
	<head>
		<meta charset="UTF-8" />
		<title>Wikipedia</title>

		<meta name="referrer" content="no-referrer" />
		<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no,viewport-fit=cover" />
		<meta name="format-detection" content="telephone=no" />

		<meta name="apple-mobile-web-app-title" content="Wikipedia" />
		<link rel="shortcut icon" href="../Resources/search.png" />

		<link rel="stylesheet" href="../Resources/main.css" />
		<link rel="stylesheet" href="../Resources/default.css" />
	</head>
	<body>
		<div id="header">
			<div>
				<form action="https://ja.wikipedia.org/w/index.php" method="GET">
					<input type="text" role="searchbox" placeholder="Wikipedia" name="search" autofocus="autofocus" />
					<span id="params"></span>
				</form>
				<a style="--image:url(../Wikipedia/images/Wikipedia.svg);" id="icon" href="https://ja.wikipedia.org/wiki/Main_Page"></a>
			</div>
		</div>
		<noscript><div id="message"><div>Type keywords above and press return key</div></div></noscript>
		<script>
			(()=>{

				/* dom function abbreviation */
				let qs=(q,t=document.body)=>t.querySelector(q),
				ce=(html)=>{
					let d=document.createElement("div");
					d.innerHTML=html;
					let e=d.firstChild;
					d.removeChild(e);
					return e;
				};

				/* element */
				let q=qs('[name="search"]'),
				f=qs("form"), /* form */
				a=qs("a"), /* icon */
				pl=qs("#params"),
				useLang=ce(`<input type="hidden" name="uselang" value="ja" />`);

				/* icon works as a submit button */
				a.addEventListener("click",e=>{
					if (q.value!="") {f.submit();e.preventDefault();}
				});

				/* list constructor */
				let construct=(data)=>{
					let o={
						data:data,
						node:ce(`<div class="list" />`),
						current:0,
					};
					let p=new Proxy(o,{
						set:(t,p,n)=>{
							if (p=="current") {
								o.current=n;
								didStateChange();
								data.forEach((d,m)=>d.node.classList.toggle("selected",n==m));
							}
						}
					});
					data.forEach((d,n)=>{
						let cell=ce(`<div><div>${d.name}</div></div>`);
						if (n==0) cell.classList.toggle("selected");
						cell.style.setProperty("--char",d.char?`"${d.char}"`:'" "');
						cell.style.setProperty("--image",d.image?`url(${d.image})`:"");
						if (d.small) cell.classList.toggle("small",true);
						cell.addEventListener("click",()=>{p.current=n;q.focus();});
						d.node=cell;
						o.node.append(cell);
					});
					return p;
				};

				/* called when the state changed */
				let didStateChange=()=>{
					let sd=search.data[search.current];
					let ld=languages.data[languages.current];
					if (sd.lang.findIndex(t=>t==ld.tag)==-1) {
						languages.current=1;
						return;
					}

					let rl=Array.from(languages.data);
					let ll=sd.lang.map(t=>{
						let i=rl.findIndex(d=>d.tag==t);
						return rl.splice(i,1)[0];
					});
					rl.forEach(d=>{
						if (d.node.parentNode==languages.node) languages.node.removeChild(d.node);
					});
					ll.forEach(d=>languages.node.appendChild(d.node));

					let m=ld.tag=="multi";
					if (m) {
						a.href=sd.main;
						f.action="";
					}
					else {
						a.href=sd.link.replace("{lang}",ld.tag).replace("{mainPage}",ld.mainPage);
						f.action=sd.action.replace("{lang}",ld.tag);
					}
					a.style.setProperty("--image",sd.image?`url(${sd.image})`:"");
					tp(useLang,sd.useLang);
					q.placeholder=sd.name;
					q.disabled=m;
					if (m) q.value="";
					if (m) location.href=sd.main;
				};

				/* toggle a certain parameter */
				let tp=(p,b)=>{
					if (p.parentNode&&(!b)) pl.removeChild(p);
					if ((!p.parentNode)&&b) pl.appendChild(p);
					return p;
				};

				let langs="ja,en,de,fr,es,pt,it,nl,ru,zh";

				/* search data */
				let search=construct([
					{
						name:"Wikipedia",
						link:"https://{lang}.wikipedia.org/wiki/Main_Page",
						action:"https://{lang}.wikipedia.org/w/index.php",
						main:"https://www.wikipedia.org/",
						lang:langs+",simple,la,eo,multi"
					},
					{
						name:"Wiktionary",
						link:"https://{lang}.wiktionary.org/wiki/Wiktionary:Main_Page",
						action:"https://{lang}.wiktionary.org/w/index.php",
						main:"https://www.wiktionary.org/",
						lang:langs+",simple,la,eo,multi"
					},
					{
						name:"Wikibooks",
						link:"https://{lang}.wikibooks.org/wiki/Main_Page",
						action:"https://{lang}.wikibooks.org/w/index.php",
						main:"https://www.wikibooks.org/",
						lang:langs+",simple,la,eo,multi"
					},
					{
						name:"Wikisource",
						link:"https://{lang}.wikisource.org/wiki/Main_Page",
						action:"https://{lang}.wikisource.org/w/index.php",
						main:"https://wikisource.org/",
						lang:langs+",la,eo,multi"
					},
					{
						name:"Wikiversity",
						link:"https://{lang}.wikiversity.org/wiki/Main_Page",
						action:"https://{lang}.wikiversity.org/w/index.php",
						main:"https://www.wikiversity.org/",
						lang:langs+",multi"
					},
					{
						name:"Wikinews",
						link:"https://{lang}.wikinews.org/wiki/Main_Page",
						action:"https://{lang}.wikinews.org/w/index.php",
						main:"https://www.wikinews.org/",
						lang:langs+",eo,multi"
					},
					{
						name:"Wikiquote",
						link:"https://{lang}.wikiquote.org/wiki/Main_Page",
						action:"https://{lang}.wikiquote.org/w/index.php",
						main:"https://www.wikiquote.org/",
						lang:langs+",multi"
					},
					{
						name:"Wikivoyage",
						link:"https://{lang}.wikivoyage.org/wiki/Main_Page",
						action:"https://{lang}.wikivoyage.org/w/index.php",
						main:"https://www.wikivoyage.org/",
						lang:langs+",multi"
					},
					{
						name:"Wikispecies",
						link:"https://species.wikimedia.org/wiki/{mainPage}",
						action:"https://species.wikimedia.org/w/index.php",
						lang:langs+",simple,eo",
						useLang:true
					},
					{
						name:"Wikidata",
						link:"https://www.wikidata.org/wiki/Wikidata:Main_Page?uselang={lang}",
						action:"https://www.wikidata.org/w/index.php",
						lang:langs+",eo",
						useLang:true
					},
					{
						name:"Meta-Wiki",
						link:"https://meta.wikimedia.org/wiki/Main_Page",
						action:"https://meta.wikimedia.org/w/index.php",
						lang:"en"
					},
					{
						name:"Commons",
						link:"https://commons.wikimedia.org/wiki/Main_Page?uselang={lang}",
						action:"https://commons.wikimedia.org/w/index.php",
						lang:langs+",eo",
						useLang:true
					}
				].map(d=>{
					d.char="";
					d.image=`../Wikipedia/images/${d.name}.svg`;
					d.lang=d.lang.split(",");
					return d;
				}));
				search.node.classList.toggle("hidden",true);
				document.body.append(search.node);

				/* language data */
				let languages=construct([
					{
						name:"日本語",
						tag:"ja",
						char:"🇯🇵",
						mainPage:"メインページ"
					},
					{
						name:"English",
						tag:"en",
						char:"🇬🇧",
						mainPage:"Main_Page"
					},
					{
						name:"English",
						tag:"en",
						char:"🇬🇧",
						mainPage:"Main_Page"
					},
					{
						name:"Deutsch",
						tag:"de",
						char:"🇩🇪",
						mainPage:"Hauptseite"
					},
					{
						name:"Français",
						tag:"fr",
						char:"🇫🇷",
						mainPage:"Accueil"
					},
					{
						name:"Español",
						tag:"es",
						char:"🇪🇸",
						mainPage:"Portada"
					},
					{
						name:"Português",
						tag:"pt",
						char:"🇵🇹",
						mainPage:"Página_principal"
					},
					{
						name:"Italiano",
						tag:"it",
						char:"🇮🇹",
						mainPage:"Pagina_principale"
					},
					{
						name:"Nederlands",
						tag:"nl",
						char:"🇳🇱",
						mainPage:"Hoofdpagina"
					},
					{
						name:"Русский",
						tag:"ru",
						char:"🇷🇺",
						mainPage:"Заглавная_страница"
					},
					{
						name:"中文",
						tag:"zh",
						char:"🇨🇳",
						mainPage:"主頁"
					},
					{
						name:"Simple English",
						tag:"simple",
						char:"EN",
						small:true,
						mainPage:"Main_Page_(Simple_English)"
					},
					{
						name:"Esperanto",
						tag:"eo",
						char:"EO",
						small:true,
						mainPage:"Ĉefpaĝo"
					},
					{
						name:"Latina",
						tag:"la",
						char:"LA",
						small:true
					},
					{
						name:"Multilingual",
						tag:"multi",
						char:""
					}
				].map(d=>{
					d.image="";
					return d;
				}));
				document.body.append(languages.node);

				document.documentElement.classList.toggle("hide-bar",false);
				let bb=qs("#header>div").appendChild(ce(`<div id="bottomBar"><div class="selected">Language</div><div>Project</div><div>GET</div></div>`));
				let setBB=n=>{
					if (n==2) {
						let m=f.method.toLowerCase();
						switch (m) {
							case "get": m="POST"; break;
							case "post": m="GET"; break;
							default: m="GET";
						}
						f.method=m;
						bb.lastChild.textContent=m;
					}
					else {
						bb.childNodes.forEach((b,m)=>b.classList.toggle("selected",n==m));
						[languages,search].forEach((o,m)=>o.node.classList.toggle("hidden",n!=m));
					}
				};
				bb.childNodes.forEach((b,n)=>b.addEventListener("click",e=>{setBB(n);e.preventDefault();}));

				didStateChange();

			})();
		</script>
	</body>
</html>